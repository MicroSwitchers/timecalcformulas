<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel Date Formula Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0B1120;
            background-image: 
                radial-gradient(at 10% 20%, hsla(210, 40%, 15%, 0.4) 0px, transparent 50%),
                radial-gradient(at 80% 90%, hsla(330, 40%, 15%, 0.3) 0px, transparent 50%),
                radial-gradient(at 50% 50%, hsla(260, 40%, 10%, 0.2) 0px, transparent 50%);
        }
        h1, h2, h3 {
            font-family: 'Poppins', sans-serif;
        }
        .tab-active {
            color: #f59e0b; /* Amber 500 */
            border-color: #f59e0b;
        }
        .card-main {
            background-color: rgba(23, 29, 43, 0.6); /* Semi-transparent background */
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .copy-button {
             background: linear-gradient(to right, #f59e0b, #fbbf24); /* Amber gradient */
        }
    </style>
</head>
<body class="text-gray-300 antialiased">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl">
        <header class="text-center mb-10">
            <div class="inline-block bg-gray-800 p-3 rounded-xl mb-4 border border-gray-700">
                <img src="timecalcexcel.svg" alt="Time Calculation Icon" class="w-8 h-8">
            </div>
            <h1 class="text-4xl sm:text-5xl font-bold text-white tracking-tight">Excel Formula Generator</h1>
            <p class="mt-4 text-md sm:text-lg text-gray-400 max-w-2xl mx-auto">ECVCs can use this app to easily create formulas to calculate time elapsed, ages and age categories in Excel.</p>
        </header>

        <div class="card-main rounded-2xl shadow-2xl p-6 sm:p-8">
            <!-- Tabs -->
            <div class="flex border-b border-gray-700 mb-8">
                <button id="tab-report" class="flex-1 pb-3 px-1 text-center font-semibold text-gray-400 border-b-2 border-transparent hover:text-white transition-colors duration-200 ease-in-out focus:outline-none tab-active" onclick="switchTab('report')">
                    Time Since Report/FSP
                </button>
                <button id="tab-birthday" class="flex-1 pb-3 px-1 text-center font-semibold text-gray-400 border-b-2 border-transparent hover:text-white transition-colors duration-200 ease-in-out focus:outline-none" onclick="switchTab('birthday')">
                    Calculate Age
                </button>
                <button id="tab-category" class="flex-1 pb-3 px-1 text-center font-semibold text-gray-400 border-b-2 border-transparent hover:text-white transition-colors duration-200 ease-in-out focus:outline-none" onclick="switchTab('category')">
                    Age Category
                </button>
            </div>

            <!-- Report Calculator -->
            <div id="calculator-report">
                <h2 class="text-2xl font-bold mb-2 text-white">Time Since Last Report or FSP</h2>
                <p class="text-gray-400 mb-8">Calculate the time passed since a report or FSP date.</p>
                <div class="space-y-6">
                    <div>
                        <label for="report-cell" class="block text-sm font-medium text-gray-300 mb-2">1. Which cell has the date?</label>
                        <input type="text" id="report-cell" value="A2" class="w-full px-4 py-2 bg-gray-900/50 border border-gray-700 text-white rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition">
                    </div>
                    <div>
                        <label for="report-unit" class="block text-sm font-medium text-gray-300 mb-2">2. What unit of time do you want to measure?</label>
                        <select id="report-unit" class="w-full px-4 py-2 bg-gray-900/50 border border-gray-700 text-white rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition">
                            <option value="d">Days</option><option value="w">Weeks</option><option value="m">Months</option><option value="y">Years</option>
                        </select>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-white mb-2">3. Your Excel Formula</h3>
                        <div class="mt-2 p-4 bg-gray-900 rounded-lg flex items-center justify-between border border-gray-700">
                            <code id="report-formula" class="text-cyan-300 font-mono text-sm sm:text-base break-all"></code>
                            <button onclick="copyToClipboard('report-formula', 'report-copy-feedback')" class="copy-button ml-4 px-4 py-2 text-gray-900 font-semibold rounded-lg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-amber-500 transition-opacity duration-200 flex items-center space-x-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                                <span>Copy</span>
                            </button>
                        </div>
                         <span id="report-copy-feedback" class="text-green-500 text-sm mt-2 opacity-0 transition-opacity">Copied!</span>
                    </div>
                </div>
            </div>

            <!-- Birthday Calculator -->
            <div id="calculator-birthday" class="hidden">
                 <h2 class="text-2xl font-bold mb-2 text-white">Calculate Age</h2>
                <p class="text-gray-400 mb-8">Calculate the current age in your desired format.</p>
                <div class="space-y-6">
                    <div>
                        <label for="birthday-cell" class="block text-sm font-medium text-gray-300 mb-2">1. Which cell has the birth date?</label>
                        <input type="text" id="birthday-cell" value="B2" class="w-full px-4 py-2 bg-gray-900/50 border border-gray-700 text-white rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition">
                    </div>
                     <div>
                        <label for="age-format" class="block text-sm font-medium text-gray-300 mb-2">2. Choose the age format</label>
                        <select id="age-format" class="w-full px-4 py-2 bg-gray-900/50 border border-gray-700 text-white rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition">
                            <option value="ym">Years, Months</option><option value="wd">Weeks, Days</option>
                        </select>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-white mb-2">3. Your Excel Formula</h3>
                        <div class="mt-2 p-4 bg-gray-900 rounded-lg flex items-center justify-between border border-gray-700">
                            <code id="birthday-formula" class="text-cyan-300 font-mono text-sm sm:text-base break-all"></code>
                            <button onclick="copyToClipboard('birthday-formula', 'birthday-copy-feedback')" class="copy-button ml-4 px-4 py-2 text-gray-900 font-semibold rounded-lg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-amber-500 transition-opacity duration-200 flex items-center space-x-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                                <span>Copy</span>
                            </button>
                        </div>
                        <span id="birthday-copy-feedback" class="text-green-500 text-sm mt-2 opacity-0 transition-opacity">Copied!</span>
                    </div>
                </div>
            </div>

            <!-- Age Category Calculator -->
            <div id="calculator-category" class="hidden">
                 <h2 class="text-2xl font-bold mb-2 text-white">Determine Age Category</h2>
                <p class="text-gray-400 mb-8">Automatically categorize an individual based on their age in months.</p>
                <div class="space-y-6">
                    <div>
                        <label for="category-cell" class="block text-sm font-medium text-gray-300 mb-2">1. Which cell has the birth date?</label>
                        <input type="text" id="category-cell" value="C2" class="w-full px-4 py-2 bg-gray-900/50 border border-gray-700 text-white rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition">
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-white mb-2">2. Your Excel Formula</h3>
                        <div class="mt-2 p-4 bg-gray-900 rounded-lg flex items-center justify-between border border-gray-700">
                            <code id="category-formula" class="text-cyan-300 font-mono text-sm sm:text-base break-all"></code>
                            <button onclick="copyToClipboard('category-formula', 'category-copy-feedback')" class="copy-button ml-4 px-4 py-2 text-gray-900 font-semibold rounded-lg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-amber-500 transition-opacity duration-200 flex items-center space-x-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                                <span>Copy</span>
                            </button>
                        </div>
                        <span id="category-copy-feedback" class="text-green-500 text-sm mt-2 opacity-0 transition-opacity">Copied!</span>
                    </div>
                     <div class="!mt-8 pt-6 border-t border-gray-700">
                        <h3 class="text-lg font-semibold text-white">How to Use in Excel</h3>
                        <ol class="list-decimal list-inside mt-2 space-y-2 text-gray-400">
                            <li>Click on an empty cell in your spreadsheet.</li>
                            <li>Copy the generated formula and paste it into the formula bar.</li>
                            <li>Ensure the cell in the formula (e.g., <span class="font-mono bg-gray-700 text-gray-300 px-1.5 py-0.5 rounded">C2</span>) matches the cell with the birth date.</li>
                            <li>Press <span class="font-semibold text-gray-200">Enter</span>.</li>
                            <li>If you see "Invalid Date", the source cell is empty or the date is not formatted correctly.</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const reportCellInput = document.getElementById('report-cell');
        const reportUnitSelect = document.getElementById('report-unit');
        const reportFormulaCode = document.getElementById('report-formula');
        const birthdayCellInput = document.getElementById('birthday-cell');
        const ageFormatSelect = document.getElementById('age-format');
        const birthdayFormulaCode = document.getElementById('birthday-formula');
        const categoryCellInput = document.getElementById('category-cell');
        const categoryFormulaCode = document.getElementById('category-formula');
        const tabs = {
            report: document.getElementById('tab-report'),
            birthday: document.getElementById('tab-birthday'),
            category: document.getElementById('tab-category')
        };
        const calculators = {
            report: document.getElementById('calculator-report'),
            birthday: document.getElementById('calculator-birthday'),
            category: document.getElementById('calculator-category')
        };

        // --- Functions ---
        function updateReportFormula() {
            const cell = reportCellInput.value.trim() || 'A2';
            const unit = reportUnitSelect.value;
            let coreFormula = unit === 'w' 
                ? `INT((TODAY()-${cell})/7)` 
                : `DATEDIF(${cell}, TODAY(), "${unit}")`;
            reportFormulaCode.textContent = `=IFERROR(${coreFormula}, "Invalid Date")`;
        }

        function updateBirthdayFormula() {
            const cell = birthdayCellInput.value.trim() || 'B2';
            const format = ageFormatSelect.value;
            let coreFormula = format === 'ym'
                ? `DATEDIF(${cell}, TODAY(), "y") & "y " & DATEDIF(${cell}, TODAY(), "ym") & "m"`
                : `INT((TODAY()-${cell})/7) & "w " & MOD(TODAY()-${cell}, 7) & "d"`;
            birthdayFormulaCode.textContent = `=IFERROR(${coreFormula}, "Invalid Date")`;
        }

        function updateAgeCategoryFormula() {
            const cell = categoryCellInput.value.trim() || 'C2';
            const coreFormula = `IF(DATEDIF(${cell},TODAY(),"m")<=17,"Infant",IF(DATEDIF(${cell},TODAY(),"m")<=30,"Toddler",IF(DATEDIF(${cell},TODAY(),"m")<=43,"Preschool",IF(DATEDIF(${cell},TODAY(),"m")<=55,"JK",IF(DATEDIF(${cell},TODAY(),"m")<=71,"SK","Aged Out")))))`;
            categoryFormulaCode.textContent = `=IFERROR(${coreFormula}, "Invalid Date")`;
        }
        
        function switchTab(tabName) {
            Object.values(calculators).forEach(calc => calc.classList.add('hidden'));
            Object.values(tabs).forEach(tab => tab.classList.remove('tab-active'));
            calculators[tabName].classList.remove('hidden');
            tabs[tabName].classList.add('tab-active');
        }

        function copyToClipboard(elementId, feedbackId) {
            const formulaText = document.getElementById(elementId).textContent;
            const feedbackEl = document.getElementById(feedbackId);
            const textArea = document.createElement('textarea');
            textArea.value = formulaText;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                feedbackEl.style.opacity = '1';
                setTimeout(() => { feedbackEl.style.opacity = '0'; }, 2000);
            } catch (err) {
                console.error('Failed to copy text: ', err);
            }
            document.body.removeChild(textArea);
        }

        // --- Event Listeners ---
        reportCellInput.addEventListener('input', updateReportFormula);
        reportUnitSelect.addEventListener('change', updateReportFormula);
        birthdayCellInput.addEventListener('input', updateBirthdayFormula);
        ageFormatSelect.addEventListener('change', updateBirthdayFormula);
        categoryCellInput.addEventListener('input', updateAgeCategoryFormula);

        // --- Initial Setup ---
        updateReportFormula();
        updateBirthdayFormula();
        updateAgeCategoryFormula();
    </script>
</body>
</html>
